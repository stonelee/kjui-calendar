define("kjui/calendar/1.0.0/lang",[],{Su:"日",Mo:"一",Tu:"二",We:"三",Th:"四",Fr:"五",Sa:"六",Jan:"一月",Feb:"二月",Mar:"三月",Apr:"四月",May:"五月",Jun:"六月",Jul:"七月",Aug:"八月",Sep:"九月",Oct:"十月",Nov:"十一月",Dec:"十二月",Today:"今天"}),define("kjui/calendar/1.0.0/calendar",["./lang","$","gallery/moment/2.0.0/moment","gallery/handlebars/1.0.1/handlebars","arale/tip/1.1.1/tip","arale/popup/1.0.2/popup","arale/overlay/1.0.1/overlay","arale/position/1.0.0/position","arale/iframe-shim/1.0.1/iframe-shim","arale/widget/1.0.3/widget","arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","arale/calendar/0.8.4/calendar","gallery/moment/1.6.2/moment","arale/overlay/1.0.0/overlay","arale/iframe-shim/1.0.0/iframe-shim","arale/widget/1.0.3/templatable","gallery/handlebars/1.0.0/handlebars"],function(e,t,n){function l(e,t){var n,r=t.get("mode"),i=["date","month","year"];for(var s=0;s<i.length;s++)r[i[s]]&&(n=i[s]);if(!n)return;var o="[data-value="+t.get(n).current.value+"]";e.find(".focused-element").removeClass("focused-element"),e.find(o).addClass("focused-element")}function h(e,t){t=t||1;var n=[];for(var r=0;r<e;r+=t)n.push(r);return n}var r=e("$"),i=e("gallery/moment/2.0.0/moment"),s=e("gallery/handlebars/1.0.1/handlebars"),o=e("./lang"),u=e("arale/tip/1.1.1/tip"),a=e("arale/calendar/0.8.4/calendar"),f=a.extend({setup:function(){a.superclass.setup.call(this);var e=this,t=r(this.get("trigger"));t.on(this.get("triggerType"),function(){e.show(),l(e.element,e.model)}),t.on("keydown",function(t){e._keyControl(t)}),this.get("needTime")||(t.on("blur",function(){e.hide()}),e.element.on("mousedown",function(e){if(r.browser.msie&&parseInt(r.browser.version,10)<9){var n=t[0];n.onbeforedeactivate=function(){window.event.returnValue=!1,n.onbeforedeactivate=null}}e.preventDefault()}));var n=this.model;n.on("changeStartday changeMode",function(){e.renderPartial("[data-role=data-container]"),e.renderPartial("[data-role=pannel-container]"),e.renderPartial("[data-role=month-year-container]"),l(e.element,e.model)}),n.on("changeMonth changeYear",function(){var t=n.get("mode");(t.date||t.year)&&e.renderPartial("[data-role=data-container]"),e.renderPartial("[data-role=month-year-container]"),l(e.element,e.model)}),n.on("changeRange",function(){e.renderPartial("[data-role=data-container]")}),n.on("refresh",function(){l(e.element,e.model)})},show:function(){f.superclass.show.call(this),r(this.get("trigger")).focus()}}),c=f.extend({attrs:{target:null,template:'<div class="calendar"> <ul class="calendar-navigation" data-role="navigation-container"> <li class="calendar-previous-year" data-role="prev-year">&lt;&lt;</li> <li class="calendar-previous-month" data-role="prev-month">&lt;</li> <li class="calendar-month-year" data-role="month-year-container"> <span class="month" data-role="mode-month" data-value="{{month.current.value}}">{{_ month.current.label}}</span> <span class="year" data-role="mode-year">{{year.current.label}}</span> </li> <li class="calendar-next-month" data-role="next-month">&gt;</li> <li class="calendar-next-year" data-role="next-year">&gt;&gt;</li> </ul><ul class="calendar-control" data-role="pannel-container"> {{#if mode.date}} {{#each day.items}} <li class="calendar-day calendar-day-{{value}}" data-role="day" data-value="{{value}}">{{_ label}}</li> {{/each}} {{/if}} </ul><div class="calendar-data-container" data-role="data-container"> {{#if mode.date}} {{#each date.items}} <ul class="calendar-date-column"> {{#each this}} <li class="calendar-day-{{day}} {{className}} {{#unless available}}disabled-date{{/unless}} " data-role="date" data-value="{{value}}" >{{label}}</li> {{/each}} </ul> {{/each}} {{/if}}{{#if mode.month}} {{#each month.items}} <ul class="calendar-month-column"> {{#each this}} <li data-role="month" data-value="{{value}}">{{_ label}}</li> {{/each}} </ul> {{/each}} {{/if}}{{#if mode.year}} {{#each year.items}} <ul class="calendar-year-column"> {{#each this}} <li data-role="{{role}}" data-value="{{value}}">{{_ label}}</li> {{/each}} </ul> {{/each}} {{/if}} </div><div class="calendar-footer" data-role="time-container"> <button class="btn" data-role="today">{{_ message.today}}</button> {{#if mode.time}} <div class="calendar-time" data-role="time"><span class="calendar-hour">{{time.hour}}</span> : {{time.minute}}</div> {{/if}} </div></div>',startDay:1,needTime:!1,needHour:!0,needMinute:!0,needSecond:!1,trigger:{value:"",getter:function(){if(!this._$trigger){var e=r(this.get("target"));this._$trigger=r('<a class="icon-form-date-trigger" href="javascript:;"></a>').insertAfter(e)}return this._$trigger}},output:{value:"",getter:function(e){return e=e?e:this.get("target"),r(e)}},align:{getter:function(){var e=this.get("target");return e?{selfXY:[0,0],baseElement:e,baseXY:[0,r(e).height()+5]}:{selfXY:[0,0],baseXY:[0,0]}}}},setup:function(){c.superclass.setup.call(this);if(this.get("needTime")){this.set("hideOnSelect",!1);var e="YYYY-MM-DD ";this.get("needHour")&&(e+="HH"),this.get("needMinute")&&(e+=":mm"),this.get("needSecond")&&(e+=":ss"),this.set("format",e);var t=s.compile('<div class="calendar-time" data-role="time-container"> {{#if needHour}}<input type="text" data-role="hour">时{{/if}} {{#if needMinute}}<input type="text" data-role="minute">分{{/if}} {{#if needSecond}}<input type="text" data-role="second">秒{{/if}} <a class="btn" data-role="now">现在</a> </div> <div class="calendar-footer"> <button class="btn" data-role="ok">确定</button> <button class="btn" data-role="cancel">取消</button> </div>{{#if needHour}} <div class="calendar-overlay" data-role="hours"> <ul> {{#each hours}} <li>{{this}}</li> {{/each}} </ul> <div class="calendar-overlay-triangle-shadow" style="left:10px;"></div> <div class="calendar-overlay-triangle" style="left:10px;"></div> </div> {{/if}}{{#if needMinute}} <div class="calendar-overlay" data-role="minutes"> <ul> {{#each minutes}} <li>{{this}}</li> {{/each}} </ul> <div class="calendar-overlay-triangle-shadow" style="left:50px;"></div> <div class="calendar-overlay-triangle" style="left:50px;"></div> </div> {{/if}}{{#if needSecond}} <div class="calendar-overlay" data-role="seconds"> <ul> {{#each seconds}} <li>{{this}}</li> {{/each}} </ul> <div class="calendar-overlay-triangle-shadow" style="left:90px;"></div> <div class="calendar-overlay-triangle" style="left:90px;"></div> </div> {{/if}}')({needHour:this.get("needHour"),needMinute:this.get("needMinute"),needSecond:this.get("needSecond"),hours:h(24),minutes:h(60,5),seconds:h(60,5)});this.$("[data-role=time-container]").replaceWith(t),this.delegateEvents({"keyup [data-role=hour],[data-role=minute],[data-role=second]":"_changeTime","click [data-role=ok]":"_onOk","click [data-role=cancel]":"_onCancel","click [data-role=now]":"_selectNow"}),this.get("needHour")&&this._bindTip("hour","+5"),this.get("needMinute")&&this._bindTip("minute","-30"),this.get("needSecond")&&this._bindTip("second","-70")}},_bindTip:function(e,t){var n=this,i=new u({element:n.$("[data-role="+e+"s]"),trigger:n.$("[data-role="+e+"]"),triggerType:"click",direction:"up",pointPos:"50%"+t});i.delegateEvents({"click li":function(t){var i=r(t.target).text();n.$("[data-role="+e+"]").val(i),n._setTimeToOutput(),this.hide()}})},show:function(){c.superclass.show.call(this);if(this.get("needTime")){var e=this.get("output"),t=e.val();t?(t=i(t),this.originTime=t):(t=i(),this.setFocus(t)),this.$("[data-role=hour]").val(t.hour()),this.$("[data-role=minute]").val(t.minute()),this.$("[data-role=second]").val(t.second()),e.val(t.format(this.get("format")))}},_fillDate:function(){c.superclass._fillDate.apply(this,arguments),this.get("needTime")&&this._setTimeToOutput()},_changeTime:function(e){var t=r(e.target),n=t.val(),i={hour:23,minute:59,second:59};n=n.replace(/\D/g,"");if(n){n=parseInt(n,10);var s=i[t.attr("data-role")];n>s&&(n=s)}t.val(n),this._setTimeToOutput()},_setTimeToOutput:function(){var e=this.get("output"),t=e.val();t?t=i(t):t=i(),t.hour(this.$("[data-role=hour]").val()),t.minute(this.$("[data-role=minute]").val()),t.second(this.$("[data-role=second]").val()),e.val(t.format(this.get("format")))},_onOk:function(){this.hide()},_onCancel:function(){var e;this.originTime?e=this.originTime.format(this.get("format")):e="",this.get("output").val(e),this.hide()},_selectNow:function(){var e=i().format("YYYY-MM-DD"),t=this.model.selectDate(e);t=i(),this.$("[data-role=hour]").val(t.hour()),this.$("[data-role=minute]").val(t.minute()),this.$("[data-role=second]").val(t.second()),this._fillDate(t)},templateHelpers:{_:function(e){return o[e]||e}}});c.autoRender=function(e){e.target=e.element,e.element="",new c(e)},n.exports=c});