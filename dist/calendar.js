define("kjui/calendar/1.0.0/calendar",["$","gallery/moment/2.0.0/moment","gallery/handlebars/1.0.0/handlebars","./lang","arale/tip/1.1.1/tip","arale/popup/1.0.2/popup","arale/overlay/1.0.1/overlay","arale/position/1.0.0/position","arale/iframe-shim/1.0.1/iframe-shim","arale/widget/1.0.3/widget","arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","arale/calendar/0.8.5/calendar","arale/widget/1.0.3/templatable","./calendar.tpl","./time.tpl"],function(e,a,t){function n(e,a){for(var t,n=a.get("mode"),l=["date","month","year"],i=0;l.length>i;i++)n[l[i]]&&(t=l[i]);if(t){var r="[data-value="+a.get(t).current.value+"]";e.find(".focused-element").removeClass("focused-element"),e.find(r).addClass("focused-element")}}function l(e,a){a=a||1;for(var t=[],n=0;e>n;n+=a)t.push(n);return t}var i=e("$"),r=e("gallery/moment/2.0.0/moment"),o=e("gallery/handlebars/1.0.0/handlebars"),s=e("./lang"),d=e("arale/tip/1.1.1/tip"),c=e("arale/calendar/0.8.5/calendar"),u=c.extend({setup:function(){c.superclass.setup.call(this);var e=this,a=i(this.get("trigger"));a.on(this.get("triggerType"),function(){e.show(),n(e.element,e.model)}),a.on("keydown",function(a){e._keyControl(a)}),this.get("needTime")||(a.on("blur",function(){e.hide()}),e.element.on("mousedown",function(e){if(i.browser.msie&&9>parseInt(i.browser.version,10)){var t=a[0];t.onbeforedeactivate=function(){window.event.returnValue=!1,t.onbeforedeactivate=null}}e.preventDefault()}));var t=this.model;t.on("changeStartday changeMode",function(){e.renderPartial("[data-role=data-container]"),e.renderPartial("[data-role=pannel-container]"),e.renderPartial("[data-role=month-year-container]"),n(e.element,e.model)}),t.on("changeMonth changeYear",function(){var a=t.get("mode");(a.date||a.year)&&e.renderPartial("[data-role=data-container]"),e.renderPartial("[data-role=month-year-container]"),n(e.element,e.model)}),t.on("changeRange",function(){e.renderPartial("[data-role=data-container]")}),t.on("refresh",function(){n(e.element,e.model)})},show:function(){u.superclass.show.call(this),i(this.get("trigger")).focus()}}),h=u.extend({attrs:{target:null,template:e("./calendar.tpl"),startDay:1,needTime:!1,needHour:!0,needMinute:!0,needSecond:!1,trigger:{value:"",getter:function(){if(!this._$trigger){var e=i(this.get("target"));this._$trigger=i('<a class="icon-form-date-trigger" href="javascript:;"></a>').insertAfter(e)}return this._$trigger}},output:{value:"",getter:function(e){return e=e?e:this.get("target"),i(e)}},align:{getter:function(){var e=this.get("target");return e?{selfXY:[0,0],baseElement:e,baseXY:[0,i(e).height()+5]}:{selfXY:[0,0],baseXY:[0,0]}}}},setup:function(){if(h.superclass.setup.call(this),this.get("needTime")){this.set("hideOnSelect",!1);var a="YYYY-MM-DD ";this.get("needHour")&&(a+="HH"),this.get("needMinute")&&(a+=":mm"),this.get("needSecond")&&(a+=":ss"),this.set("format",a);var t=o.compile(e("./time.tpl"))({needHour:this.get("needHour"),needMinute:this.get("needMinute"),needSecond:this.get("needSecond"),hours:l(24),minutes:l(60,5),seconds:l(60,5)});this.$("[data-role=time-container]").replaceWith(t),this.delegateEvents({"keyup [data-role=hour],[data-role=minute],[data-role=second]":"_changeTime","click [data-role=ok]":"_onOk","click [data-role=cancel]":"_onCancel","click [data-role=now]":"_selectNow"}),this.get("needHour")&&this._bindTip("hour","+5"),this.get("needMinute")&&this._bindTip("minute","-30"),this.get("needSecond")&&this._bindTip("second","-70")}},_bindTip:function(e,a){var t=this,n=new d({element:t.$("[data-role="+e+"s]"),trigger:t.$("[data-role="+e+"]"),triggerType:"click",direction:"up",pointPos:"50%"+a});n.delegateEvents({"click li":function(a){var n=i(a.target).text();t.$("[data-role="+e+"]").val(n),t._setTimeToOutput(),this.hide()}})},show:function(){if(h.superclass.show.call(this),this.get("needTime")){var e=this.get("output"),a=e.val();a?(a=r(a),this.originTime=a):(a=r(),this.setFocus(a)),this.$("[data-role=hour]").val(a.hour()),this.$("[data-role=minute]").val(a.minute()),this.$("[data-role=second]").val(a.second()),e.val(a.format(this.get("format")))}},_fillDate:function(){h.superclass._fillDate.apply(this,arguments),this.get("needTime")&&this._setTimeToOutput()},_changeTime:function(e){var a=i(e.target),t=a.val(),n={hour:23,minute:59,second:59};if(t=t.replace(/\D/g,"")){t=parseInt(t,10);var l=n[a.attr("data-role")];t>l&&(t=l)}a.val(t),this._setTimeToOutput()},_setTimeToOutput:function(){var e=this.get("output"),a=e.val();a=a?r(a):r(),a.hour(this.$("[data-role=hour]").val()),a.minute(this.$("[data-role=minute]").val()),a.second(this.$("[data-role=second]").val()),e.val(a.format(this.get("format")))},_onOk:function(){this.hide()},_onCancel:function(){var e;e=this.originTime?this.originTime.format(this.get("format")):"",this.get("output").val(e),this.hide()},_selectNow:function(){var e=r().format("YYYY-MM-DD"),a=this.model.selectDate(e);a=r(),this.$("[data-role=hour]").val(a.hour()),this.$("[data-role=minute]").val(a.minute()),this.$("[data-role=second]").val(a.second()),this._fillDate(a)},templateHelpers:{_:function(e){return s[e]||e}}});h.autoRender=function(e){e.target=e.element,e.element="",new h(e)},t.exports=h}),define("kjui/calendar/1.0.0/lang",[],{Su:"日",Mo:"一",Tu:"二",We:"三",Th:"四",Fr:"五",Sa:"六",Jan:"一月",Feb:"二月",Mar:"三月",Apr:"四月",May:"五月",Jun:"六月",Jul:"七月",Aug:"八月",Sep:"九月",Oct:"十月",Nov:"十一月",Dec:"十二月",Today:"今天"}),define("kjui/calendar/1.0.0/calendar.tpl",[],'<div class="calendar">\n    <ul class="calendar-navigation" data-role="navigation-container">\n        <li class="calendar-previous-year" data-role="prev-year">&lt;&lt;</li>\n        <li class="calendar-previous-month" data-role="prev-month">&lt;</li>\n        <li class="calendar-month-year" data-role="month-year-container">\n        <span class="month" data-role="mode-month" data-value="{{month.current.value}}">{{_ month.current.label}}</span>\n        <span class="year" data-role="mode-year">{{year.current.label}}</span>\n        </li>\n        <li class="calendar-next-month" data-role="next-month">&gt;</li>\n        <li class="calendar-next-year" data-role="next-year">&gt;&gt;</li>\n    </ul>\n\n    <ul class="calendar-control" data-role="pannel-container">\n        {{#if mode.date}}\n        {{#each day.items}}\n        <li class="calendar-day calendar-day-{{value}}" data-role="day" data-value="{{value}}">{{_ label}}</li>\n        {{/each}}\n        {{/if}}\n    </ul>\n\n    <div class="calendar-data-container" data-role="data-container">\n        {{#if mode.date}}\n        {{#each date.items}}\n        <ul class="calendar-date-column">\n            {{#each this}}\n            <li class="calendar-day-{{day}} {{className}}\n            {{#unless available}}disabled-date{{/unless}}\n            "\n            data-role="date" data-value="{{value}}"\n            >{{label}}</li>\n            {{/each}}\n        </ul>\n        {{/each}}\n        {{/if}}\n\n        {{#if mode.month}}\n        {{#each month.items}}\n        <ul class="calendar-month-column">\n            {{#each this}}\n            <li data-role="month" data-value="{{value}}">{{_ label}}</li>\n            {{/each}}\n        </ul>\n        {{/each}}\n        {{/if}}\n\n        {{#if mode.year}}\n        {{#each year.items}}\n        <ul class="calendar-year-column">\n            {{#each this}}\n            <li data-role="{{role}}" data-value="{{value}}">{{_ label}}</li>\n            {{/each}}\n        </ul>\n        {{/each}}\n        {{/if}}\n    </div>\n\n    <div class="calendar-footer" data-role="time-container">\n      <button class="btn" data-role="today">{{_ message.today}}</button>\n      {{#if mode.time}}\n      <div class="calendar-time" data-role="time"><span class="calendar-hour">{{time.hour}}</span> : {{time.minute}}</div>\n      {{/if}}\n    </div>\n\n</div>\n\n'),define("kjui/calendar/1.0.0/time.tpl",[],'<div class="calendar-time" data-role="time-container">\n  {{#if needHour}}<input type="text" data-role="hour">时{{/if}}\n  {{#if needMinute}}<input type="text" data-role="minute">分{{/if}}\n  {{#if needSecond}}<input type="text" data-role="second">秒{{/if}}\n  <a class="btn" data-role="now">现在</a>\n</div>\n<div class="calendar-footer">\n  <button class="btn" data-role="ok">确定</button>\n  <button class="btn" data-role="cancel">取消</button>\n</div>\n\n{{#if needHour}}\n  <div class="calendar-overlay" data-role="hours">\n    <ul>\n      {{#each hours}}\n        <li>{{this}}</li>\n      {{/each}}\n    </ul>\n    <div class="calendar-overlay-triangle-shadow" style="left:10px;"></div>\n    <div class="calendar-overlay-triangle" style="left:10px;"></div>\n  </div>\n{{/if}}\n\n{{#if needMinute}}\n  <div class="calendar-overlay" data-role="minutes">\n    <ul>\n      {{#each minutes}}\n        <li>{{this}}</li>\n      {{/each}}\n    </ul>\n    <div class="calendar-overlay-triangle-shadow" style="left:50px;"></div>\n    <div class="calendar-overlay-triangle" style="left:50px;"></div>\n  </div>\n{{/if}}\n\n{{#if needSecond}}\n  <div class="calendar-overlay" data-role="seconds">\n    <ul>\n      {{#each seconds}}\n        <li>{{this}}</li>\n      {{/each}}\n    </ul>\n    <div class="calendar-overlay-triangle-shadow" style="left:90px;"></div>\n    <div class="calendar-overlay-triangle" style="left:90px;"></div>\n  </div>\n{{/if}}\n');
